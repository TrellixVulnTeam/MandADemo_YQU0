{"ast":null,"code":"function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e2) {\n          throw _e2;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e3) {\n      didErr = true;\n      err = _e3;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it.return != null) it.return();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n/**\n * @license\n * Copyright (c) 2021 Handsoncode. All rights reserved.\n */\n\n\nimport { CellError, movedSimpleCellAddress } from '../Cell';\nimport { AddRowsTransformer } from '../dependencyTransformers/AddRowsTransformer';\nimport { RemoveRowsTransformer } from '../dependencyTransformers/RemoveRowsTransformer';\nimport { forceNormalizeString } from '../interpreter/ArithmeticHelper';\nimport { EmptyValue, getRawValue } from '../interpreter/InterpreterValue';\nimport { SimpleRangeValue } from '../interpreter/SimpleRangeValue';\nimport { StatType } from '../statistics';\nimport { ColumnBinarySearch } from './ColumnBinarySearch';\nexport var ColumnIndex = /*#__PURE__*/function () {\n  function ColumnIndex(dependencyGraph, config, stats) {\n    _classCallCheck(this, ColumnIndex);\n\n    this.dependencyGraph = dependencyGraph;\n    this.config = config;\n    this.stats = stats;\n    this.index = new Map();\n    this.transformingService = this.dependencyGraph.lazilyTransformingAstService;\n    this.binarySearchStrategy = new ColumnBinarySearch(dependencyGraph, config);\n  }\n\n  _createClass(ColumnIndex, [{\n    key: \"add\",\n    value: function add(value, address) {\n      if (value === EmptyValue || value instanceof CellError) {\n        return;\n      } else if (value instanceof SimpleRangeValue) {\n        var _iterator = _createForOfIteratorHelper(value.entriesFromTopLeftCorner(address)),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var _step$value = _slicedToArray(_step.value, 2),\n                arrayValue = _step$value[0],\n                cellAddress = _step$value[1];\n\n            this.addSingleCellValue(getRawValue(arrayValue), cellAddress);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      } else {\n        this.addSingleCellValue(value, address);\n      }\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(value, address) {\n      if (value === undefined) {\n        return;\n      }\n\n      if (value instanceof SimpleRangeValue) {\n        var _iterator2 = _createForOfIteratorHelper(value.entriesFromTopLeftCorner(address)),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _step2$value = _slicedToArray(_step2.value, 2),\n                arrayValue = _step2$value[0],\n                cellAddress = _step2$value[1];\n\n            this.removeSingleValue(getRawValue(arrayValue), cellAddress);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      } else {\n        this.removeSingleValue(value, address);\n      }\n    }\n  }, {\n    key: \"change\",\n    value: function change(oldValue, newValue, address) {\n      if (oldValue === newValue) {\n        return;\n      }\n\n      this.remove(oldValue, address);\n      this.add(newValue, address);\n    }\n  }, {\n    key: \"applyChanges\",\n    value: function applyChanges(contentChanges) {\n      var _iterator3 = _createForOfIteratorHelper(contentChanges),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var change = _step3.value;\n\n          if (change.oldValue !== undefined) {\n            this.change(getRawValue(change.oldValue), getRawValue(change.value), change.address);\n          }\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }, {\n    key: \"moveValues\",\n    value: function moveValues(sourceRange, toRight, toBottom, toSheet) {\n      var _iterator4 = _createForOfIteratorHelper(sourceRange),\n          _step4;\n\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var _step4$value = _slicedToArray(_step4.value, 2),\n              value = _step4$value[0],\n              address = _step4$value[1];\n\n          var targetAddress = movedSimpleCellAddress(address, toSheet, toRight, toBottom);\n          this.remove(value, address);\n          this.add(value, targetAddress);\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n    }\n  }, {\n    key: \"removeValues\",\n    value: function removeValues(range) {\n      var _iterator5 = _createForOfIteratorHelper(range),\n          _step5;\n\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var _step5$value = _slicedToArray(_step5.value, 2),\n              value = _step5$value[0],\n              address = _step5$value[1];\n\n          this.remove(value, address);\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n    }\n  }, {\n    key: \"find\",\n    value: function find(key, rangeValue, sorted) {\n      var range = rangeValue.range;\n\n      if (range === undefined) {\n        return this.binarySearchStrategy.find(key, rangeValue, sorted);\n      }\n\n      this.ensureRecentData(range.sheet, range.start.col, key);\n      var columnMap = this.getColumnMap(range.sheet, range.start.col);\n\n      if (!columnMap) {\n        return -1;\n      }\n\n      if (typeof key === 'string') {\n        key = forceNormalizeString(key);\n      }\n\n      var valueIndex = columnMap.get(key);\n\n      if (!valueIndex) {\n        return this.binarySearchStrategy.find(key, rangeValue, sorted);\n      }\n\n      var index = upperBound(valueIndex.index, range.start.row);\n      var rowNumber = valueIndex.index[index];\n      return rowNumber <= range.end.row ? rowNumber - range.start.row : this.binarySearchStrategy.find(key, rangeValue, sorted);\n    }\n  }, {\n    key: \"advancedFind\",\n    value: function advancedFind(keyMatcher, range) {\n      return this.binarySearchStrategy.advancedFind(keyMatcher, range);\n    }\n  }, {\n    key: \"addColumns\",\n    value: function addColumns(columnsSpan) {\n      var sheetIndex = this.index.get(columnsSpan.sheet);\n\n      if (!sheetIndex) {\n        return;\n      }\n\n      sheetIndex.splice.apply(sheetIndex, [columnsSpan.columnStart, 0].concat(_toConsumableArray(Array(columnsSpan.numberOfColumns))));\n    }\n  }, {\n    key: \"removeColumns\",\n    value: function removeColumns(columnsSpan) {\n      var sheetIndex = this.index.get(columnsSpan.sheet);\n\n      if (!sheetIndex) {\n        return;\n      }\n\n      sheetIndex.splice(columnsSpan.columnStart, columnsSpan.numberOfColumns);\n    }\n  }, {\n    key: \"removeSheet\",\n    value: function removeSheet(sheetId) {\n      this.index.delete(sheetId);\n    }\n  }, {\n    key: \"getColumnMap\",\n    value: function getColumnMap(sheet, col) {\n      if (!this.index.has(sheet)) {\n        this.index.set(sheet, []);\n      }\n\n      var sheetMap = this.index.get(sheet); // eslint-disable-line @typescript-eslint/no-non-null-assertion\n\n      var columnMap = sheetMap[col];\n\n      if (!columnMap) {\n        columnMap = new Map();\n        sheetMap[col] = columnMap;\n      }\n\n      return columnMap;\n    }\n  }, {\n    key: \"getValueIndex\",\n    value: function getValueIndex(sheet, col, value) {\n      var columnMap = this.getColumnMap(sheet, col);\n      var index = this.getColumnMap(sheet, col).get(value);\n\n      if (!index) {\n        index = {\n          version: this.transformingService.version(),\n          index: []\n        };\n        columnMap.set(value, index);\n      }\n\n      return index;\n    }\n  }, {\n    key: \"ensureRecentData\",\n    value: function ensureRecentData(sheet, col, value) {\n      var valueIndex = this.getValueIndex(sheet, col, value);\n      var actualVersion = this.transformingService.version();\n\n      if (valueIndex.version === actualVersion) {\n        return;\n      }\n\n      var relevantTransformations = this.transformingService.getTransformationsFrom(valueIndex.version, function (transformation) {\n        return transformation.sheet === sheet && (transformation instanceof AddRowsTransformer || transformation instanceof RemoveRowsTransformer);\n      });\n\n      var _iterator6 = _createForOfIteratorHelper(relevantTransformations),\n          _step6;\n\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var transformation = _step6.value;\n\n          if (transformation instanceof AddRowsTransformer) {\n            this.addRows(col, transformation.rowsSpan, value);\n          } else if (transformation instanceof RemoveRowsTransformer) {\n            this.removeRows(col, transformation.rowsSpan, value);\n          }\n        }\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n\n      valueIndex.version = actualVersion;\n    }\n  }, {\n    key: \"addSingleCellValue\",\n    value: function addSingleCellValue(value, address) {\n      var _this = this;\n\n      this.stats.measure(StatType.BUILD_COLUMN_INDEX, function () {\n        _this.ensureRecentData(address.sheet, address.col, value);\n\n        if (typeof value === 'string') {\n          value = forceNormalizeString(value);\n        }\n\n        var valueIndex = _this.getValueIndex(address.sheet, address.col, value);\n\n        _this.addValue(valueIndex, address.row);\n      });\n    }\n  }, {\n    key: \"removeSingleValue\",\n    value: function removeSingleValue(value, address) {\n      var _this2 = this;\n\n      this.stats.measure(StatType.BUILD_COLUMN_INDEX, function () {\n        _this2.ensureRecentData(address.sheet, address.col, value);\n\n        var columnMap = _this2.getColumnMap(address.sheet, address.col);\n\n        if (typeof value === 'string') {\n          value = forceNormalizeString(value);\n        }\n\n        var valueIndex = columnMap.get(value);\n\n        if (!valueIndex) {\n          return;\n        }\n\n        var index = upperBound(valueIndex.index, address.row);\n        valueIndex.index.splice(index, 1);\n\n        if (valueIndex.index.length === 0) {\n          columnMap.delete(value);\n        }\n\n        if (columnMap.size === 0) {\n          delete _this2.index.get(address.sheet)[address.col]; // eslint-disable-line @typescript-eslint/no-non-null-assertion\n        }\n      });\n    }\n  }, {\n    key: \"addRows\",\n    value: function addRows(col, rowsSpan, value) {\n      var valueIndex = this.getValueIndex(rowsSpan.sheet, col, value);\n      this.shiftRows(valueIndex, rowsSpan.rowStart, rowsSpan.numberOfRows);\n    }\n  }, {\n    key: \"removeRows\",\n    value: function removeRows(col, rowsSpan, value) {\n      var valueIndex = this.getValueIndex(rowsSpan.sheet, col, value);\n      this.removeRowsFromValues(valueIndex, rowsSpan);\n      this.shiftRows(valueIndex, rowsSpan.rowEnd + 1, -rowsSpan.numberOfRows);\n    }\n  }, {\n    key: \"addValue\",\n    value: function addValue(valueIndex, rowNumber) {\n      var rowIndex = lowerBound(valueIndex.index, rowNumber);\n      var value = valueIndex.index[rowIndex];\n\n      if (value === rowNumber) {\n        /* do not add same row twice */\n        return;\n      }\n\n      if (rowIndex === valueIndex.index.length - 1) {\n        valueIndex.index.push(rowNumber);\n      } else {\n        valueIndex.index.splice(rowIndex + 1, 0, rowNumber);\n      }\n    }\n  }, {\n    key: \"removeRowsFromValues\",\n    value: function removeRowsFromValues(rows, rowsSpan) {\n      var start = upperBound(rows.index, rowsSpan.rowStart);\n      var end = lowerBound(rows.index, rowsSpan.rowEnd);\n\n      if (rows.index[start] <= rowsSpan.rowEnd) {\n        rows.index.splice(start, end - start + 1);\n      }\n    }\n  }, {\n    key: \"shiftRows\",\n    value: function shiftRows(rows, afterRow, numberOfRows) {\n      var index = upperBound(rows.index, afterRow);\n\n      for (var i = index; i < rows.index.length; ++i) {\n        rows.index[i] += numberOfRows;\n      }\n    }\n  }]);\n\n  return ColumnIndex;\n}();\n/*\n* If key exists returns index of key\n* Otherwise returns index of smallest element greater than key\n* assuming sorted array and no repetitions\n* */\n\nexport function upperBound(values, key) {\n  var start = 0;\n  var end = values.length - 1;\n\n  while (start <= end) {\n    var center = Math.floor((start + end) / 2);\n\n    if (key > values[center]) {\n      start = center + 1;\n    } else if (key < values[center]) {\n      end = center - 1;\n    } else {\n      return center;\n    }\n  }\n\n  return start;\n}\n/*\n* If key exists returns index of key\n* Otherwise returns index of greatest element smaller than key\n* assuming sorted array and no repetitions\n* */\n\nexport function lowerBound(values, key) {\n  var start = 0;\n  var end = values.length - 1;\n\n  while (start <= end) {\n    var center = Math.floor((start + end) / 2);\n\n    if (key > values[center]) {\n      start = center + 1;\n    } else if (key < values[center]) {\n      end = center - 1;\n    } else {\n      return center;\n    }\n  }\n\n  return end;\n}","map":{"version":3,"sources":["/Users/mingjie.wang/Documents/Uber/MandA/demo-project/node_modules/hyperformula/es/Lookup/ColumnIndex.js"],"names":["_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","iter","Symbol","iterator","Array","from","isArray","_arrayLikeToArray","_slicedToArray","i","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","_i","_arr","_n","_d","_s","_e","call","next","done","push","value","length","err","_createForOfIteratorHelper","o","allowArrayLike","it","F","s","n","e","_e2","f","normalCompletion","didErr","step","_e3","return","minLen","Object","prototype","toString","slice","constructor","name","test","len","arr2","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","_createClass","protoProps","staticProps","CellError","movedSimpleCellAddress","AddRowsTransformer","RemoveRowsTransformer","forceNormalizeString","EmptyValue","getRawValue","SimpleRangeValue","StatType","ColumnBinarySearch","ColumnIndex","dependencyGraph","config","stats","index","Map","transformingService","lazilyTransformingAstService","binarySearchStrategy","add","address","_iterator","entriesFromTopLeftCorner","_step","_step$value","arrayValue","cellAddress","addSingleCellValue","remove","undefined","_iterator2","_step2","_step2$value","removeSingleValue","change","oldValue","newValue","applyChanges","contentChanges","_iterator3","_step3","moveValues","sourceRange","toRight","toBottom","toSheet","_iterator4","_step4","_step4$value","targetAddress","removeValues","range","_iterator5","_step5","_step5$value","find","rangeValue","sorted","ensureRecentData","sheet","start","col","columnMap","getColumnMap","valueIndex","get","upperBound","row","rowNumber","end","advancedFind","keyMatcher","addColumns","columnsSpan","sheetIndex","splice","apply","columnStart","concat","numberOfColumns","removeColumns","removeSheet","sheetId","delete","has","set","sheetMap","getValueIndex","version","actualVersion","relevantTransformations","getTransformationsFrom","transformation","_iterator6","_step6","addRows","rowsSpan","removeRows","_this","measure","BUILD_COLUMN_INDEX","addValue","_this2","size","shiftRows","rowStart","numberOfRows","removeRowsFromValues","rowEnd","rowIndex","lowerBound","rows","afterRow","values","center","Math","floor"],"mappings":"AAAA,SAASA,kBAAT,CAA4BC,GAA5B,EAAiC;AAAE,SAAOC,kBAAkB,CAACD,GAAD,CAAlB,IAA2BE,gBAAgB,CAACF,GAAD,CAA3C,IAAoDG,2BAA2B,CAACH,GAAD,CAA/E,IAAwFI,kBAAkB,EAAjH;AAAsH;;AAEzJ,SAASA,kBAAT,GAA8B;AAAE,QAAM,IAAIC,SAAJ,CAAc,sIAAd,CAAN;AAA8J;;AAE9L,SAASH,gBAAT,CAA0BI,IAA1B,EAAgC;AAAE,MAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiCD,IAAI,CAACC,MAAM,CAACC,QAAR,CAAJ,IAAyB,IAA1D,IAAkEF,IAAI,CAAC,YAAD,CAAJ,IAAsB,IAA5F,EAAkG,OAAOG,KAAK,CAACC,IAAN,CAAWJ,IAAX,CAAP;AAA0B;;AAE9J,SAASL,kBAAT,CAA4BD,GAA5B,EAAiC;AAAE,MAAIS,KAAK,CAACE,OAAN,CAAcX,GAAd,CAAJ,EAAwB,OAAOY,iBAAiB,CAACZ,GAAD,CAAxB;AAAgC;;AAE3F,SAASa,cAAT,CAAwBb,GAAxB,EAA6Bc,CAA7B,EAAgC;AAAE,SAAOC,eAAe,CAACf,GAAD,CAAf,IAAwBgB,qBAAqB,CAAChB,GAAD,EAAMc,CAAN,CAA7C,IAAyDX,2BAA2B,CAACH,GAAD,EAAMc,CAAN,CAApF,IAAgGG,gBAAgB,EAAvH;AAA4H;;AAE9J,SAASA,gBAAT,GAA4B;AAAE,QAAM,IAAIZ,SAAJ,CAAc,2IAAd,CAAN;AAAmK;;AAEjM,SAASW,qBAAT,CAA+BhB,GAA/B,EAAoCc,CAApC,EAAuC;AAAE,MAAII,EAAE,GAAGlB,GAAG,IAAI,IAAP,GAAc,IAAd,GAAqB,OAAOO,MAAP,KAAkB,WAAlB,IAAiCP,GAAG,CAACO,MAAM,CAACC,QAAR,CAApC,IAAyDR,GAAG,CAAC,YAAD,CAA1F;;AAA0G,MAAIkB,EAAE,IAAI,IAAV,EAAgB;AAAQ,MAAIC,IAAI,GAAG,EAAX;AAAe,MAAIC,EAAE,GAAG,IAAT;AAAe,MAAIC,EAAE,GAAG,KAAT;;AAAgB,MAAIC,EAAJ,EAAQC,EAAR;;AAAY,MAAI;AAAE,SAAKL,EAAE,GAAGA,EAAE,CAACM,IAAH,CAAQxB,GAAR,CAAV,EAAwB,EAAEoB,EAAE,GAAG,CAACE,EAAE,GAAGJ,EAAE,CAACO,IAAH,EAAN,EAAiBC,IAAxB,CAAxB,EAAuDN,EAAE,GAAG,IAA5D,EAAkE;AAAED,MAAAA,IAAI,CAACQ,IAAL,CAAUL,EAAE,CAACM,KAAb;;AAAqB,UAAId,CAAC,IAAIK,IAAI,CAACU,MAAL,KAAgBf,CAAzB,EAA4B;AAAQ;AAAE,GAArI,CAAsI,OAAOgB,GAAP,EAAY;AAAET,IAAAA,EAAE,GAAG,IAAL;AAAWE,IAAAA,EAAE,GAAGO,GAAL;AAAW,GAA1K,SAAmL;AAAE,QAAI;AAAE,UAAI,CAACV,EAAD,IAAOF,EAAE,CAAC,QAAD,CAAF,IAAgB,IAA3B,EAAiCA,EAAE,CAAC,QAAD,CAAF;AAAiB,KAAxD,SAAiE;AAAE,UAAIG,EAAJ,EAAQ,MAAME,EAAN;AAAW;AAAE;;AAAC,SAAOJ,IAAP;AAAc;;AAEjgB,SAASJ,eAAT,CAAyBf,GAAzB,EAA8B;AAAE,MAAIS,KAAK,CAACE,OAAN,CAAcX,GAAd,CAAJ,EAAwB,OAAOA,GAAP;AAAa;;AAErE,SAAS+B,0BAAT,CAAoCC,CAApC,EAAuCC,cAAvC,EAAuD;AAAE,MAAIC,EAAE,GAAG,OAAO3B,MAAP,KAAkB,WAAlB,IAAiCyB,CAAC,CAACzB,MAAM,CAACC,QAAR,CAAlC,IAAuDwB,CAAC,CAAC,YAAD,CAAjE;;AAAiF,MAAI,CAACE,EAAL,EAAS;AAAE,QAAIzB,KAAK,CAACE,OAAN,CAAcqB,CAAd,MAAqBE,EAAE,GAAG/B,2BAA2B,CAAC6B,CAAD,CAArD,KAA6DC,cAAc,IAAID,CAAlB,IAAuB,OAAOA,CAAC,CAACH,MAAT,KAAoB,QAA5G,EAAsH;AAAE,UAAIK,EAAJ,EAAQF,CAAC,GAAGE,EAAJ;AAAQ,UAAIpB,CAAC,GAAG,CAAR;;AAAW,UAAIqB,CAAC,GAAG,SAASA,CAAT,GAAa,CAAE,CAAvB;;AAAyB,aAAO;AAAEC,QAAAA,CAAC,EAAED,CAAL;AAAQE,QAAAA,CAAC,EAAE,SAASA,CAAT,GAAa;AAAE,cAAIvB,CAAC,IAAIkB,CAAC,CAACH,MAAX,EAAmB,OAAO;AAAEH,YAAAA,IAAI,EAAE;AAAR,WAAP;AAAuB,iBAAO;AAAEA,YAAAA,IAAI,EAAE,KAAR;AAAeE,YAAAA,KAAK,EAAEI,CAAC,CAAClB,CAAC,EAAF;AAAvB,WAAP;AAAwC,SAA5G;AAA8GwB,QAAAA,CAAC,EAAE,SAASA,CAAT,CAAWC,GAAX,EAAgB;AAAE,gBAAMA,GAAN;AAAY,SAA/I;AAAiJC,QAAAA,CAAC,EAAEL;AAApJ,OAAP;AAAiK;;AAAC,UAAM,IAAI9B,SAAJ,CAAc,uIAAd,CAAN;AAA+J;;AAAC,MAAIoC,gBAAgB,GAAG,IAAvB;AAAA,MAA6BC,MAAM,GAAG,KAAtC;AAAA,MAA6CZ,GAA7C;AAAkD,SAAO;AAAEM,IAAAA,CAAC,EAAE,SAASA,CAAT,GAAa;AAAEF,MAAAA,EAAE,GAAGA,EAAE,CAACV,IAAH,CAAQQ,CAAR,CAAL;AAAkB,KAAtC;AAAwCK,IAAAA,CAAC,EAAE,SAASA,CAAT,GAAa;AAAE,UAAIM,IAAI,GAAGT,EAAE,CAACT,IAAH,EAAX;AAAsBgB,MAAAA,gBAAgB,GAAGE,IAAI,CAACjB,IAAxB;AAA8B,aAAOiB,IAAP;AAAc,KAA5H;AAA8HL,IAAAA,CAAC,EAAE,SAASA,CAAT,CAAWM,GAAX,EAAgB;AAAEF,MAAAA,MAAM,GAAG,IAAT;AAAeZ,MAAAA,GAAG,GAAGc,GAAN;AAAY,KAA9K;AAAgLJ,IAAAA,CAAC,EAAE,SAASA,CAAT,GAAa;AAAE,UAAI;AAAE,YAAI,CAACC,gBAAD,IAAqBP,EAAE,CAACW,MAAH,IAAa,IAAtC,EAA4CX,EAAE,CAACW,MAAH;AAAc,OAAhE,SAAyE;AAAE,YAAIH,MAAJ,EAAY,MAAMZ,GAAN;AAAY;AAAE;AAAvS,GAAP;AAAmT;;AAEx+B,SAAS3B,2BAAT,CAAqC6B,CAArC,EAAwCc,MAAxC,EAAgD;AAAE,MAAI,CAACd,CAAL,EAAQ;AAAQ,MAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,OAAOpB,iBAAiB,CAACoB,CAAD,EAAIc,MAAJ,CAAxB;AAAqC,MAAIT,CAAC,GAAGU,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BzB,IAA1B,CAA+BQ,CAA/B,EAAkCkB,KAAlC,CAAwC,CAAxC,EAA2C,CAAC,CAA5C,CAAR;AAAwD,MAAIb,CAAC,KAAK,QAAN,IAAkBL,CAAC,CAACmB,WAAxB,EAAqCd,CAAC,GAAGL,CAAC,CAACmB,WAAF,CAAcC,IAAlB;AAAwB,MAAIf,CAAC,KAAK,KAAN,IAAeA,CAAC,KAAK,KAAzB,EAAgC,OAAO5B,KAAK,CAACC,IAAN,CAAWsB,CAAX,CAAP;AAAsB,MAAIK,CAAC,KAAK,WAAN,IAAqB,2CAA2CgB,IAA3C,CAAgDhB,CAAhD,CAAzB,EAA6E,OAAOzB,iBAAiB,CAACoB,CAAD,EAAIc,MAAJ,CAAxB;AAAsC;;AAEha,SAASlC,iBAAT,CAA2BZ,GAA3B,EAAgCsD,GAAhC,EAAqC;AAAE,MAAIA,GAAG,IAAI,IAAP,IAAeA,GAAG,GAAGtD,GAAG,CAAC6B,MAA7B,EAAqCyB,GAAG,GAAGtD,GAAG,CAAC6B,MAAV;;AAAkB,OAAK,IAAIf,CAAC,GAAG,CAAR,EAAWyC,IAAI,GAAG,IAAI9C,KAAJ,CAAU6C,GAAV,CAAvB,EAAuCxC,CAAC,GAAGwC,GAA3C,EAAgDxC,CAAC,EAAjD,EAAqD;AAAEyC,IAAAA,IAAI,CAACzC,CAAD,CAAJ,GAAUd,GAAG,CAACc,CAAD,CAAb;AAAmB;;AAAC,SAAOyC,IAAP;AAAc;;AAiBvL,SAASC,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIrD,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASsD,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAAE,OAAK,IAAI/C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+C,KAAK,CAAChC,MAA1B,EAAkCf,CAAC,EAAnC,EAAuC;AAAE,QAAIgD,UAAU,GAAGD,KAAK,CAAC/C,CAAD,CAAtB;AAA2BgD,IAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AAAwDD,IAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWF,UAAf,EAA2BA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AAA4BlB,IAAAA,MAAM,CAACmB,cAAP,CAAsBN,MAAtB,EAA8BE,UAAU,CAACK,GAAzC,EAA8CL,UAA9C;AAA4D;AAAE;;AAE7T,SAASM,YAAT,CAAsBV,WAAtB,EAAmCW,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBV,iBAAiB,CAACD,WAAW,CAACV,SAAb,EAAwBqB,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBX,iBAAiB,CAACD,WAAD,EAAcY,WAAd,CAAjB;AAA6C,SAAOZ,WAAP;AAAqB;AAEvN;AACA;AACA;AACA;;;AACA,SAASa,SAAT,EAAoBC,sBAApB,QAAkD,SAAlD;AACA,SAASC,kBAAT,QAAmC,8CAAnC;AACA,SAASC,qBAAT,QAAsC,iDAAtC;AACA,SAASC,oBAAT,QAAqC,iCAArC;AACA,SAASC,UAAT,EAAqBC,WAArB,QAAwC,iCAAxC;AACA,SAASC,gBAAT,QAAiC,iCAAjC;AACA,SAASC,QAAT,QAAyB,eAAzB;AACA,SAASC,kBAAT,QAAmC,sBAAnC;AACA,OAAO,IAAIC,WAAW,GAAG,aAAa,YAAY;AAChD,WAASA,WAAT,CAAqBC,eAArB,EAAsCC,MAAtC,EAA8CC,KAA9C,EAAqD;AACnD5B,IAAAA,eAAe,CAAC,IAAD,EAAOyB,WAAP,CAAf;;AAEA,SAAKC,eAAL,GAAuBA,eAAvB;AACA,SAAKC,MAAL,GAAcA,MAAd;AACA,SAAKC,KAAL,GAAaA,KAAb;AACA,SAAKC,KAAL,GAAa,IAAIC,GAAJ,EAAb;AACA,SAAKC,mBAAL,GAA2B,KAAKL,eAAL,CAAqBM,4BAAhD;AACA,SAAKC,oBAAL,GAA4B,IAAIT,kBAAJ,CAAuBE,eAAvB,EAAwCC,MAAxC,CAA5B;AACD;;AAEDf,EAAAA,YAAY,CAACa,WAAD,EAAc,CAAC;AACzBd,IAAAA,GAAG,EAAE,KADoB;AAEzBvC,IAAAA,KAAK,EAAE,SAAS8D,GAAT,CAAa9D,KAAb,EAAoB+D,OAApB,EAA6B;AAClC,UAAI/D,KAAK,KAAKgD,UAAV,IAAwBhD,KAAK,YAAY2C,SAA7C,EAAwD;AACtD;AACD,OAFD,MAEO,IAAI3C,KAAK,YAAYkD,gBAArB,EAAuC;AAC5C,YAAIc,SAAS,GAAG7D,0BAA0B,CAACH,KAAK,CAACiE,wBAAN,CAA+BF,OAA/B,CAAD,CAA1C;AAAA,YACIG,KADJ;;AAGA,YAAI;AACF,eAAKF,SAAS,CAACxD,CAAV,EAAL,EAAoB,CAAC,CAAC0D,KAAK,GAAGF,SAAS,CAACvD,CAAV,EAAT,EAAwBX,IAA7C,GAAoD;AAClD,gBAAIqE,WAAW,GAAGlF,cAAc,CAACiF,KAAK,CAAClE,KAAP,EAAc,CAAd,CAAhC;AAAA,gBACIoE,UAAU,GAAGD,WAAW,CAAC,CAAD,CAD5B;AAAA,gBAEIE,WAAW,GAAGF,WAAW,CAAC,CAAD,CAF7B;;AAIA,iBAAKG,kBAAL,CAAwBrB,WAAW,CAACmB,UAAD,CAAnC,EAAiDC,WAAjD;AACD;AACF,SARD,CAQE,OAAOnE,GAAP,EAAY;AACZ8D,UAAAA,SAAS,CAACtD,CAAV,CAAYR,GAAZ;AACD,SAVD,SAUU;AACR8D,UAAAA,SAAS,CAACpD,CAAV;AACD;AACF,OAjBM,MAiBA;AACL,aAAK0D,kBAAL,CAAwBtE,KAAxB,EAA+B+D,OAA/B;AACD;AACF;AAzBwB,GAAD,EA0BvB;AACDxB,IAAAA,GAAG,EAAE,QADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASuE,MAAT,CAAgBvE,KAAhB,EAAuB+D,OAAvB,EAAgC;AACrC,UAAI/D,KAAK,KAAKwE,SAAd,EAAyB;AACvB;AACD;;AAED,UAAIxE,KAAK,YAAYkD,gBAArB,EAAuC;AACrC,YAAIuB,UAAU,GAAGtE,0BAA0B,CAACH,KAAK,CAACiE,wBAAN,CAA+BF,OAA/B,CAAD,CAA3C;AAAA,YACIW,MADJ;;AAGA,YAAI;AACF,eAAKD,UAAU,CAACjE,CAAX,EAAL,EAAqB,CAAC,CAACkE,MAAM,GAAGD,UAAU,CAAChE,CAAX,EAAV,EAA0BX,IAAhD,GAAuD;AACrD,gBAAI6E,YAAY,GAAG1F,cAAc,CAACyF,MAAM,CAAC1E,KAAR,EAAe,CAAf,CAAjC;AAAA,gBACIoE,UAAU,GAAGO,YAAY,CAAC,CAAD,CAD7B;AAAA,gBAEIN,WAAW,GAAGM,YAAY,CAAC,CAAD,CAF9B;;AAIA,iBAAKC,iBAAL,CAAuB3B,WAAW,CAACmB,UAAD,CAAlC,EAAgDC,WAAhD;AACD;AACF,SARD,CAQE,OAAOnE,GAAP,EAAY;AACZuE,UAAAA,UAAU,CAAC/D,CAAX,CAAaR,GAAb;AACD,SAVD,SAUU;AACRuE,UAAAA,UAAU,CAAC7D,CAAX;AACD;AACF,OAjBD,MAiBO;AACL,aAAKgE,iBAAL,CAAuB5E,KAAvB,EAA8B+D,OAA9B;AACD;AACF;AA3BA,GA1BuB,EAsDvB;AACDxB,IAAAA,GAAG,EAAE,QADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS6E,MAAT,CAAgBC,QAAhB,EAA0BC,QAA1B,EAAoChB,OAApC,EAA6C;AAClD,UAAIe,QAAQ,KAAKC,QAAjB,EAA2B;AACzB;AACD;;AAED,WAAKR,MAAL,CAAYO,QAAZ,EAAsBf,OAAtB;AACA,WAAKD,GAAL,CAASiB,QAAT,EAAmBhB,OAAnB;AACD;AATA,GAtDuB,EAgEvB;AACDxB,IAAAA,GAAG,EAAE,cADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASgF,YAAT,CAAsBC,cAAtB,EAAsC;AAC3C,UAAIC,UAAU,GAAG/E,0BAA0B,CAAC8E,cAAD,CAA3C;AAAA,UACIE,MADJ;;AAGA,UAAI;AACF,aAAKD,UAAU,CAAC1E,CAAX,EAAL,EAAqB,CAAC,CAAC2E,MAAM,GAAGD,UAAU,CAACzE,CAAX,EAAV,EAA0BX,IAAhD,GAAuD;AACrD,cAAI+E,MAAM,GAAGM,MAAM,CAACnF,KAApB;;AAEA,cAAI6E,MAAM,CAACC,QAAP,KAAoBN,SAAxB,EAAmC;AACjC,iBAAKK,MAAL,CAAY5B,WAAW,CAAC4B,MAAM,CAACC,QAAR,CAAvB,EAA0C7B,WAAW,CAAC4B,MAAM,CAAC7E,KAAR,CAArD,EAAqE6E,MAAM,CAACd,OAA5E;AACD;AACF;AACF,OARD,CAQE,OAAO7D,GAAP,EAAY;AACZgF,QAAAA,UAAU,CAACxE,CAAX,CAAaR,GAAb;AACD,OAVD,SAUU;AACRgF,QAAAA,UAAU,CAACtE,CAAX;AACD;AACF;AAnBA,GAhEuB,EAoFvB;AACD2B,IAAAA,GAAG,EAAE,YADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASoF,UAAT,CAAoBC,WAApB,EAAiCC,OAAjC,EAA0CC,QAA1C,EAAoDC,OAApD,EAA6D;AAClE,UAAIC,UAAU,GAAGtF,0BAA0B,CAACkF,WAAD,CAA3C;AAAA,UACIK,MADJ;;AAGA,UAAI;AACF,aAAKD,UAAU,CAACjF,CAAX,EAAL,EAAqB,CAAC,CAACkF,MAAM,GAAGD,UAAU,CAAChF,CAAX,EAAV,EAA0BX,IAAhD,GAAuD;AACrD,cAAI6F,YAAY,GAAG1G,cAAc,CAACyG,MAAM,CAAC1F,KAAR,EAAe,CAAf,CAAjC;AAAA,cACIA,KAAK,GAAG2F,YAAY,CAAC,CAAD,CADxB;AAAA,cAEI5B,OAAO,GAAG4B,YAAY,CAAC,CAAD,CAF1B;;AAIA,cAAIC,aAAa,GAAGhD,sBAAsB,CAACmB,OAAD,EAAUyB,OAAV,EAAmBF,OAAnB,EAA4BC,QAA5B,CAA1C;AACA,eAAKhB,MAAL,CAAYvE,KAAZ,EAAmB+D,OAAnB;AACA,eAAKD,GAAL,CAAS9D,KAAT,EAAgB4F,aAAhB;AACD;AACF,OAVD,CAUE,OAAO1F,GAAP,EAAY;AACZuF,QAAAA,UAAU,CAAC/E,CAAX,CAAaR,GAAb;AACD,OAZD,SAYU;AACRuF,QAAAA,UAAU,CAAC7E,CAAX;AACD;AACF;AArBA,GApFuB,EA0GvB;AACD2B,IAAAA,GAAG,EAAE,cADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS6F,YAAT,CAAsBC,KAAtB,EAA6B;AAClC,UAAIC,UAAU,GAAG5F,0BAA0B,CAAC2F,KAAD,CAA3C;AAAA,UACIE,MADJ;;AAGA,UAAI;AACF,aAAKD,UAAU,CAACvF,CAAX,EAAL,EAAqB,CAAC,CAACwF,MAAM,GAAGD,UAAU,CAACtF,CAAX,EAAV,EAA0BX,IAAhD,GAAuD;AACrD,cAAImG,YAAY,GAAGhH,cAAc,CAAC+G,MAAM,CAAChG,KAAR,EAAe,CAAf,CAAjC;AAAA,cACIA,KAAK,GAAGiG,YAAY,CAAC,CAAD,CADxB;AAAA,cAEIlC,OAAO,GAAGkC,YAAY,CAAC,CAAD,CAF1B;;AAIA,eAAK1B,MAAL,CAAYvE,KAAZ,EAAmB+D,OAAnB;AACD;AACF,OARD,CAQE,OAAO7D,GAAP,EAAY;AACZ6F,QAAAA,UAAU,CAACrF,CAAX,CAAaR,GAAb;AACD,OAVD,SAUU;AACR6F,QAAAA,UAAU,CAACnF,CAAX;AACD;AACF;AAnBA,GA1GuB,EA8HvB;AACD2B,IAAAA,GAAG,EAAE,MADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASkG,IAAT,CAAc3D,GAAd,EAAmB4D,UAAnB,EAA+BC,MAA/B,EAAuC;AAC5C,UAAIN,KAAK,GAAGK,UAAU,CAACL,KAAvB;;AAEA,UAAIA,KAAK,KAAKtB,SAAd,EAAyB;AACvB,eAAO,KAAKX,oBAAL,CAA0BqC,IAA1B,CAA+B3D,GAA/B,EAAoC4D,UAApC,EAAgDC,MAAhD,CAAP;AACD;;AAED,WAAKC,gBAAL,CAAsBP,KAAK,CAACQ,KAA5B,EAAmCR,KAAK,CAACS,KAAN,CAAYC,GAA/C,EAAoDjE,GAApD;AACA,UAAIkE,SAAS,GAAG,KAAKC,YAAL,CAAkBZ,KAAK,CAACQ,KAAxB,EAA+BR,KAAK,CAACS,KAAN,CAAYC,GAA3C,CAAhB;;AAEA,UAAI,CAACC,SAAL,EAAgB;AACd,eAAO,CAAC,CAAR;AACD;;AAED,UAAI,OAAOlE,GAAP,KAAe,QAAnB,EAA6B;AAC3BA,QAAAA,GAAG,GAAGQ,oBAAoB,CAACR,GAAD,CAA1B;AACD;;AAED,UAAIoE,UAAU,GAAGF,SAAS,CAACG,GAAV,CAAcrE,GAAd,CAAjB;;AAEA,UAAI,CAACoE,UAAL,EAAiB;AACf,eAAO,KAAK9C,oBAAL,CAA0BqC,IAA1B,CAA+B3D,GAA/B,EAAoC4D,UAApC,EAAgDC,MAAhD,CAAP;AACD;;AAED,UAAI3C,KAAK,GAAGoD,UAAU,CAACF,UAAU,CAAClD,KAAZ,EAAmBqC,KAAK,CAACS,KAAN,CAAYO,GAA/B,CAAtB;AACA,UAAIC,SAAS,GAAGJ,UAAU,CAAClD,KAAX,CAAiBA,KAAjB,CAAhB;AACA,aAAOsD,SAAS,IAAIjB,KAAK,CAACkB,GAAN,CAAUF,GAAvB,GAA6BC,SAAS,GAAGjB,KAAK,CAACS,KAAN,CAAYO,GAArD,GAA2D,KAAKjD,oBAAL,CAA0BqC,IAA1B,CAA+B3D,GAA/B,EAAoC4D,UAApC,EAAgDC,MAAhD,CAAlE;AACD;AA7BA,GA9HuB,EA4JvB;AACD7D,IAAAA,GAAG,EAAE,cADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASiH,YAAT,CAAsBC,UAAtB,EAAkCpB,KAAlC,EAAyC;AAC9C,aAAO,KAAKjC,oBAAL,CAA0BoD,YAA1B,CAAuCC,UAAvC,EAAmDpB,KAAnD,CAAP;AACD;AAJA,GA5JuB,EAiKvB;AACDvD,IAAAA,GAAG,EAAE,YADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASmH,UAAT,CAAoBC,WAApB,EAAiC;AACtC,UAAIC,UAAU,GAAG,KAAK5D,KAAL,CAAWmD,GAAX,CAAeQ,WAAW,CAACd,KAA3B,CAAjB;;AAEA,UAAI,CAACe,UAAL,EAAiB;AACf;AACD;;AAEDA,MAAAA,UAAU,CAACC,MAAX,CAAkBC,KAAlB,CAAwBF,UAAxB,EAAoC,CAACD,WAAW,CAACI,WAAb,EAA0B,CAA1B,EAA6BC,MAA7B,CAAoCtJ,kBAAkB,CAACU,KAAK,CAACuI,WAAW,CAACM,eAAb,CAAN,CAAtD,CAApC;AACD;AAVA,GAjKuB,EA4KvB;AACDnF,IAAAA,GAAG,EAAE,eADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS2H,aAAT,CAAuBP,WAAvB,EAAoC;AACzC,UAAIC,UAAU,GAAG,KAAK5D,KAAL,CAAWmD,GAAX,CAAeQ,WAAW,CAACd,KAA3B,CAAjB;;AAEA,UAAI,CAACe,UAAL,EAAiB;AACf;AACD;;AAEDA,MAAAA,UAAU,CAACC,MAAX,CAAkBF,WAAW,CAACI,WAA9B,EAA2CJ,WAAW,CAACM,eAAvD;AACD;AAVA,GA5KuB,EAuLvB;AACDnF,IAAAA,GAAG,EAAE,aADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS4H,WAAT,CAAqBC,OAArB,EAA8B;AACnC,WAAKpE,KAAL,CAAWqE,MAAX,CAAkBD,OAAlB;AACD;AAJA,GAvLuB,EA4LvB;AACDtF,IAAAA,GAAG,EAAE,cADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS0G,YAAT,CAAsBJ,KAAtB,EAA6BE,GAA7B,EAAkC;AACvC,UAAI,CAAC,KAAK/C,KAAL,CAAWsE,GAAX,CAAezB,KAAf,CAAL,EAA4B;AAC1B,aAAK7C,KAAL,CAAWuE,GAAX,CAAe1B,KAAf,EAAsB,EAAtB;AACD;;AAED,UAAI2B,QAAQ,GAAG,KAAKxE,KAAL,CAAWmD,GAAX,CAAeN,KAAf,CAAf,CALuC,CAKD;;AAEtC,UAAIG,SAAS,GAAGwB,QAAQ,CAACzB,GAAD,CAAxB;;AAEA,UAAI,CAACC,SAAL,EAAgB;AACdA,QAAAA,SAAS,GAAG,IAAI/C,GAAJ,EAAZ;AACAuE,QAAAA,QAAQ,CAACzB,GAAD,CAAR,GAAgBC,SAAhB;AACD;;AAED,aAAOA,SAAP;AACD;AAjBA,GA5LuB,EA8MvB;AACDlE,IAAAA,GAAG,EAAE,eADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASkI,aAAT,CAAuB5B,KAAvB,EAA8BE,GAA9B,EAAmCxG,KAAnC,EAA0C;AAC/C,UAAIyG,SAAS,GAAG,KAAKC,YAAL,CAAkBJ,KAAlB,EAAyBE,GAAzB,CAAhB;AACA,UAAI/C,KAAK,GAAG,KAAKiD,YAAL,CAAkBJ,KAAlB,EAAyBE,GAAzB,EAA8BI,GAA9B,CAAkC5G,KAAlC,CAAZ;;AAEA,UAAI,CAACyD,KAAL,EAAY;AACVA,QAAAA,KAAK,GAAG;AACN0E,UAAAA,OAAO,EAAE,KAAKxE,mBAAL,CAAyBwE,OAAzB,EADH;AAEN1E,UAAAA,KAAK,EAAE;AAFD,SAAR;AAIAgD,QAAAA,SAAS,CAACuB,GAAV,CAAchI,KAAd,EAAqByD,KAArB;AACD;;AAED,aAAOA,KAAP;AACD;AAfA,GA9MuB,EA8NvB;AACDlB,IAAAA,GAAG,EAAE,kBADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASqG,gBAAT,CAA0BC,KAA1B,EAAiCE,GAAjC,EAAsCxG,KAAtC,EAA6C;AAClD,UAAI2G,UAAU,GAAG,KAAKuB,aAAL,CAAmB5B,KAAnB,EAA0BE,GAA1B,EAA+BxG,KAA/B,CAAjB;AACA,UAAIoI,aAAa,GAAG,KAAKzE,mBAAL,CAAyBwE,OAAzB,EAApB;;AAEA,UAAIxB,UAAU,CAACwB,OAAX,KAAuBC,aAA3B,EAA0C;AACxC;AACD;;AAED,UAAIC,uBAAuB,GAAG,KAAK1E,mBAAL,CAAyB2E,sBAAzB,CAAgD3B,UAAU,CAACwB,OAA3D,EAAoE,UAAUI,cAAV,EAA0B;AAC1H,eAAOA,cAAc,CAACjC,KAAf,KAAyBA,KAAzB,KAAmCiC,cAAc,YAAY1F,kBAA1B,IAAgD0F,cAAc,YAAYzF,qBAA7G,CAAP;AACD,OAF6B,CAA9B;;AAIA,UAAI0F,UAAU,GAAGrI,0BAA0B,CAACkI,uBAAD,CAA3C;AAAA,UACII,MADJ;;AAGA,UAAI;AACF,aAAKD,UAAU,CAAChI,CAAX,EAAL,EAAqB,CAAC,CAACiI,MAAM,GAAGD,UAAU,CAAC/H,CAAX,EAAV,EAA0BX,IAAhD,GAAuD;AACrD,cAAIyI,cAAc,GAAGE,MAAM,CAACzI,KAA5B;;AAEA,cAAIuI,cAAc,YAAY1F,kBAA9B,EAAkD;AAChD,iBAAK6F,OAAL,CAAalC,GAAb,EAAkB+B,cAAc,CAACI,QAAjC,EAA2C3I,KAA3C;AACD,WAFD,MAEO,IAAIuI,cAAc,YAAYzF,qBAA9B,EAAqD;AAC1D,iBAAK8F,UAAL,CAAgBpC,GAAhB,EAAqB+B,cAAc,CAACI,QAApC,EAA8C3I,KAA9C;AACD;AACF;AACF,OAVD,CAUE,OAAOE,GAAP,EAAY;AACZsI,QAAAA,UAAU,CAAC9H,CAAX,CAAaR,GAAb;AACD,OAZD,SAYU;AACRsI,QAAAA,UAAU,CAAC5H,CAAX;AACD;;AAED+F,MAAAA,UAAU,CAACwB,OAAX,GAAqBC,aAArB;AACD;AAlCA,GA9NuB,EAiQvB;AACD7F,IAAAA,GAAG,EAAE,oBADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASsE,kBAAT,CAA4BtE,KAA5B,EAAmC+D,OAAnC,EAA4C;AACjD,UAAI8E,KAAK,GAAG,IAAZ;;AAEA,WAAKrF,KAAL,CAAWsF,OAAX,CAAmB3F,QAAQ,CAAC4F,kBAA5B,EAAgD,YAAY;AAC1DF,QAAAA,KAAK,CAACxC,gBAAN,CAAuBtC,OAAO,CAACuC,KAA/B,EAAsCvC,OAAO,CAACyC,GAA9C,EAAmDxG,KAAnD;;AAEA,YAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7BA,UAAAA,KAAK,GAAG+C,oBAAoB,CAAC/C,KAAD,CAA5B;AACD;;AAED,YAAI2G,UAAU,GAAGkC,KAAK,CAACX,aAAN,CAAoBnE,OAAO,CAACuC,KAA5B,EAAmCvC,OAAO,CAACyC,GAA3C,EAAgDxG,KAAhD,CAAjB;;AAEA6I,QAAAA,KAAK,CAACG,QAAN,CAAerC,UAAf,EAA2B5C,OAAO,CAAC+C,GAAnC;AACD,OAVD;AAWD;AAhBA,GAjQuB,EAkRvB;AACDvE,IAAAA,GAAG,EAAE,mBADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS4E,iBAAT,CAA2B5E,KAA3B,EAAkC+D,OAAlC,EAA2C;AAChD,UAAIkF,MAAM,GAAG,IAAb;;AAEA,WAAKzF,KAAL,CAAWsF,OAAX,CAAmB3F,QAAQ,CAAC4F,kBAA5B,EAAgD,YAAY;AAC1DE,QAAAA,MAAM,CAAC5C,gBAAP,CAAwBtC,OAAO,CAACuC,KAAhC,EAAuCvC,OAAO,CAACyC,GAA/C,EAAoDxG,KAApD;;AAEA,YAAIyG,SAAS,GAAGwC,MAAM,CAACvC,YAAP,CAAoB3C,OAAO,CAACuC,KAA5B,EAAmCvC,OAAO,CAACyC,GAA3C,CAAhB;;AAEA,YAAI,OAAOxG,KAAP,KAAiB,QAArB,EAA+B;AAC7BA,UAAAA,KAAK,GAAG+C,oBAAoB,CAAC/C,KAAD,CAA5B;AACD;;AAED,YAAI2G,UAAU,GAAGF,SAAS,CAACG,GAAV,CAAc5G,KAAd,CAAjB;;AAEA,YAAI,CAAC2G,UAAL,EAAiB;AACf;AACD;;AAED,YAAIlD,KAAK,GAAGoD,UAAU,CAACF,UAAU,CAAClD,KAAZ,EAAmBM,OAAO,CAAC+C,GAA3B,CAAtB;AACAH,QAAAA,UAAU,CAAClD,KAAX,CAAiB6D,MAAjB,CAAwB7D,KAAxB,EAA+B,CAA/B;;AAEA,YAAIkD,UAAU,CAAClD,KAAX,CAAiBxD,MAAjB,KAA4B,CAAhC,EAAmC;AACjCwG,UAAAA,SAAS,CAACqB,MAAV,CAAiB9H,KAAjB;AACD;;AAED,YAAIyG,SAAS,CAACyC,IAAV,KAAmB,CAAvB,EAA0B;AACxB,iBAAOD,MAAM,CAACxF,KAAP,CAAamD,GAAb,CAAiB7C,OAAO,CAACuC,KAAzB,EAAgCvC,OAAO,CAACyC,GAAxC,CAAP,CADwB,CAC6B;AACtD;AACF,OAzBD;AA0BD;AA/BA,GAlRuB,EAkTvB;AACDjE,IAAAA,GAAG,EAAE,SADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS0I,OAAT,CAAiBlC,GAAjB,EAAsBmC,QAAtB,EAAgC3I,KAAhC,EAAuC;AAC5C,UAAI2G,UAAU,GAAG,KAAKuB,aAAL,CAAmBS,QAAQ,CAACrC,KAA5B,EAAmCE,GAAnC,EAAwCxG,KAAxC,CAAjB;AACA,WAAKmJ,SAAL,CAAexC,UAAf,EAA2BgC,QAAQ,CAACS,QAApC,EAA8CT,QAAQ,CAACU,YAAvD;AACD;AALA,GAlTuB,EAwTvB;AACD9G,IAAAA,GAAG,EAAE,YADJ;AAEDvC,IAAAA,KAAK,EAAE,SAAS4I,UAAT,CAAoBpC,GAApB,EAAyBmC,QAAzB,EAAmC3I,KAAnC,EAA0C;AAC/C,UAAI2G,UAAU,GAAG,KAAKuB,aAAL,CAAmBS,QAAQ,CAACrC,KAA5B,EAAmCE,GAAnC,EAAwCxG,KAAxC,CAAjB;AACA,WAAKsJ,oBAAL,CAA0B3C,UAA1B,EAAsCgC,QAAtC;AACA,WAAKQ,SAAL,CAAexC,UAAf,EAA2BgC,QAAQ,CAACY,MAAT,GAAkB,CAA7C,EAAgD,CAACZ,QAAQ,CAACU,YAA1D;AACD;AANA,GAxTuB,EA+TvB;AACD9G,IAAAA,GAAG,EAAE,UADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASgJ,QAAT,CAAkBrC,UAAlB,EAA8BI,SAA9B,EAAyC;AAC9C,UAAIyC,QAAQ,GAAGC,UAAU,CAAC9C,UAAU,CAAClD,KAAZ,EAAmBsD,SAAnB,CAAzB;AACA,UAAI/G,KAAK,GAAG2G,UAAU,CAAClD,KAAX,CAAiB+F,QAAjB,CAAZ;;AAEA,UAAIxJ,KAAK,KAAK+G,SAAd,EAAyB;AACvB;AACA;AACD;;AAED,UAAIyC,QAAQ,KAAK7C,UAAU,CAAClD,KAAX,CAAiBxD,MAAjB,GAA0B,CAA3C,EAA8C;AAC5C0G,QAAAA,UAAU,CAAClD,KAAX,CAAiB1D,IAAjB,CAAsBgH,SAAtB;AACD,OAFD,MAEO;AACLJ,QAAAA,UAAU,CAAClD,KAAX,CAAiB6D,MAAjB,CAAwBkC,QAAQ,GAAG,CAAnC,EAAsC,CAAtC,EAAyCzC,SAAzC;AACD;AACF;AAhBA,GA/TuB,EAgVvB;AACDxE,IAAAA,GAAG,EAAE,sBADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASsJ,oBAAT,CAA8BI,IAA9B,EAAoCf,QAApC,EAA8C;AACnD,UAAIpC,KAAK,GAAGM,UAAU,CAAC6C,IAAI,CAACjG,KAAN,EAAakF,QAAQ,CAACS,QAAtB,CAAtB;AACA,UAAIpC,GAAG,GAAGyC,UAAU,CAACC,IAAI,CAACjG,KAAN,EAAakF,QAAQ,CAACY,MAAtB,CAApB;;AAEA,UAAIG,IAAI,CAACjG,KAAL,CAAW8C,KAAX,KAAqBoC,QAAQ,CAACY,MAAlC,EAA0C;AACxCG,QAAAA,IAAI,CAACjG,KAAL,CAAW6D,MAAX,CAAkBf,KAAlB,EAAyBS,GAAG,GAAGT,KAAN,GAAc,CAAvC;AACD;AACF;AATA,GAhVuB,EA0VvB;AACDhE,IAAAA,GAAG,EAAE,WADJ;AAEDvC,IAAAA,KAAK,EAAE,SAASmJ,SAAT,CAAmBO,IAAnB,EAAyBC,QAAzB,EAAmCN,YAAnC,EAAiD;AACtD,UAAI5F,KAAK,GAAGoD,UAAU,CAAC6C,IAAI,CAACjG,KAAN,EAAakG,QAAb,CAAtB;;AAEA,WAAK,IAAIzK,CAAC,GAAGuE,KAAb,EAAoBvE,CAAC,GAAGwK,IAAI,CAACjG,KAAL,CAAWxD,MAAnC,EAA2C,EAAEf,CAA7C,EAAgD;AAC9CwK,QAAAA,IAAI,CAACjG,KAAL,CAAWvE,CAAX,KAAiBmK,YAAjB;AACD;AACF;AARA,GA1VuB,CAAd,CAAZ;;AAqWA,SAAOhG,WAAP;AACD,CAlXqC,EAA/B;AAmXP;AACA;AACA;AACA;AACA;;AAEA,OAAO,SAASwD,UAAT,CAAoB+C,MAApB,EAA4BrH,GAA5B,EAAiC;AACtC,MAAIgE,KAAK,GAAG,CAAZ;AACA,MAAIS,GAAG,GAAG4C,MAAM,CAAC3J,MAAP,GAAgB,CAA1B;;AAEA,SAAOsG,KAAK,IAAIS,GAAhB,EAAqB;AACnB,QAAI6C,MAAM,GAAGC,IAAI,CAACC,KAAL,CAAW,CAACxD,KAAK,GAAGS,GAAT,IAAgB,CAA3B,CAAb;;AAEA,QAAIzE,GAAG,GAAGqH,MAAM,CAACC,MAAD,CAAhB,EAA0B;AACxBtD,MAAAA,KAAK,GAAGsD,MAAM,GAAG,CAAjB;AACD,KAFD,MAEO,IAAItH,GAAG,GAAGqH,MAAM,CAACC,MAAD,CAAhB,EAA0B;AAC/B7C,MAAAA,GAAG,GAAG6C,MAAM,GAAG,CAAf;AACD,KAFM,MAEA;AACL,aAAOA,MAAP;AACD;AACF;;AAED,SAAOtD,KAAP;AACD;AACD;AACA;AACA;AACA;AACA;;AAEA,OAAO,SAASkD,UAAT,CAAoBG,MAApB,EAA4BrH,GAA5B,EAAiC;AACtC,MAAIgE,KAAK,GAAG,CAAZ;AACA,MAAIS,GAAG,GAAG4C,MAAM,CAAC3J,MAAP,GAAgB,CAA1B;;AAEA,SAAOsG,KAAK,IAAIS,GAAhB,EAAqB;AACnB,QAAI6C,MAAM,GAAGC,IAAI,CAACC,KAAL,CAAW,CAACxD,KAAK,GAAGS,GAAT,IAAgB,CAA3B,CAAb;;AAEA,QAAIzE,GAAG,GAAGqH,MAAM,CAACC,MAAD,CAAhB,EAA0B;AACxBtD,MAAAA,KAAK,GAAGsD,MAAM,GAAG,CAAjB;AACD,KAFD,MAEO,IAAItH,GAAG,GAAGqH,MAAM,CAACC,MAAD,CAAhB,EAA0B;AAC/B7C,MAAAA,GAAG,GAAG6C,MAAM,GAAG,CAAf;AACD,KAFM,MAEA;AACL,aAAOA,MAAP;AACD;AACF;;AAED,SAAO7C,GAAP;AACD","sourcesContent":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e2) { throw _e2; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e3) { didErr = true; err = _e3; }, f: function f() { try { if (!normalCompletion && it.return != null) it.return(); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport \"core-js/modules/es.array.iterator.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/es.symbol.description.js\";\nimport \"core-js/modules/es.symbol.iterator.js\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n/**\n * @license\n * Copyright (c) 2021 Handsoncode. All rights reserved.\n */\nimport { CellError, movedSimpleCellAddress } from '../Cell';\nimport { AddRowsTransformer } from '../dependencyTransformers/AddRowsTransformer';\nimport { RemoveRowsTransformer } from '../dependencyTransformers/RemoveRowsTransformer';\nimport { forceNormalizeString } from '../interpreter/ArithmeticHelper';\nimport { EmptyValue, getRawValue } from '../interpreter/InterpreterValue';\nimport { SimpleRangeValue } from '../interpreter/SimpleRangeValue';\nimport { StatType } from '../statistics';\nimport { ColumnBinarySearch } from './ColumnBinarySearch';\nexport var ColumnIndex = /*#__PURE__*/function () {\n  function ColumnIndex(dependencyGraph, config, stats) {\n    _classCallCheck(this, ColumnIndex);\n\n    this.dependencyGraph = dependencyGraph;\n    this.config = config;\n    this.stats = stats;\n    this.index = new Map();\n    this.transformingService = this.dependencyGraph.lazilyTransformingAstService;\n    this.binarySearchStrategy = new ColumnBinarySearch(dependencyGraph, config);\n  }\n\n  _createClass(ColumnIndex, [{\n    key: \"add\",\n    value: function add(value, address) {\n      if (value === EmptyValue || value instanceof CellError) {\n        return;\n      } else if (value instanceof SimpleRangeValue) {\n        var _iterator = _createForOfIteratorHelper(value.entriesFromTopLeftCorner(address)),\n            _step;\n\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var _step$value = _slicedToArray(_step.value, 2),\n                arrayValue = _step$value[0],\n                cellAddress = _step$value[1];\n\n            this.addSingleCellValue(getRawValue(arrayValue), cellAddress);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      } else {\n        this.addSingleCellValue(value, address);\n      }\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(value, address) {\n      if (value === undefined) {\n        return;\n      }\n\n      if (value instanceof SimpleRangeValue) {\n        var _iterator2 = _createForOfIteratorHelper(value.entriesFromTopLeftCorner(address)),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var _step2$value = _slicedToArray(_step2.value, 2),\n                arrayValue = _step2$value[0],\n                cellAddress = _step2$value[1];\n\n            this.removeSingleValue(getRawValue(arrayValue), cellAddress);\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n      } else {\n        this.removeSingleValue(value, address);\n      }\n    }\n  }, {\n    key: \"change\",\n    value: function change(oldValue, newValue, address) {\n      if (oldValue === newValue) {\n        return;\n      }\n\n      this.remove(oldValue, address);\n      this.add(newValue, address);\n    }\n  }, {\n    key: \"applyChanges\",\n    value: function applyChanges(contentChanges) {\n      var _iterator3 = _createForOfIteratorHelper(contentChanges),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var change = _step3.value;\n\n          if (change.oldValue !== undefined) {\n            this.change(getRawValue(change.oldValue), getRawValue(change.value), change.address);\n          }\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n  }, {\n    key: \"moveValues\",\n    value: function moveValues(sourceRange, toRight, toBottom, toSheet) {\n      var _iterator4 = _createForOfIteratorHelper(sourceRange),\n          _step4;\n\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var _step4$value = _slicedToArray(_step4.value, 2),\n              value = _step4$value[0],\n              address = _step4$value[1];\n\n          var targetAddress = movedSimpleCellAddress(address, toSheet, toRight, toBottom);\n          this.remove(value, address);\n          this.add(value, targetAddress);\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n    }\n  }, {\n    key: \"removeValues\",\n    value: function removeValues(range) {\n      var _iterator5 = _createForOfIteratorHelper(range),\n          _step5;\n\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var _step5$value = _slicedToArray(_step5.value, 2),\n              value = _step5$value[0],\n              address = _step5$value[1];\n\n          this.remove(value, address);\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n    }\n  }, {\n    key: \"find\",\n    value: function find(key, rangeValue, sorted) {\n      var range = rangeValue.range;\n\n      if (range === undefined) {\n        return this.binarySearchStrategy.find(key, rangeValue, sorted);\n      }\n\n      this.ensureRecentData(range.sheet, range.start.col, key);\n      var columnMap = this.getColumnMap(range.sheet, range.start.col);\n\n      if (!columnMap) {\n        return -1;\n      }\n\n      if (typeof key === 'string') {\n        key = forceNormalizeString(key);\n      }\n\n      var valueIndex = columnMap.get(key);\n\n      if (!valueIndex) {\n        return this.binarySearchStrategy.find(key, rangeValue, sorted);\n      }\n\n      var index = upperBound(valueIndex.index, range.start.row);\n      var rowNumber = valueIndex.index[index];\n      return rowNumber <= range.end.row ? rowNumber - range.start.row : this.binarySearchStrategy.find(key, rangeValue, sorted);\n    }\n  }, {\n    key: \"advancedFind\",\n    value: function advancedFind(keyMatcher, range) {\n      return this.binarySearchStrategy.advancedFind(keyMatcher, range);\n    }\n  }, {\n    key: \"addColumns\",\n    value: function addColumns(columnsSpan) {\n      var sheetIndex = this.index.get(columnsSpan.sheet);\n\n      if (!sheetIndex) {\n        return;\n      }\n\n      sheetIndex.splice.apply(sheetIndex, [columnsSpan.columnStart, 0].concat(_toConsumableArray(Array(columnsSpan.numberOfColumns))));\n    }\n  }, {\n    key: \"removeColumns\",\n    value: function removeColumns(columnsSpan) {\n      var sheetIndex = this.index.get(columnsSpan.sheet);\n\n      if (!sheetIndex) {\n        return;\n      }\n\n      sheetIndex.splice(columnsSpan.columnStart, columnsSpan.numberOfColumns);\n    }\n  }, {\n    key: \"removeSheet\",\n    value: function removeSheet(sheetId) {\n      this.index.delete(sheetId);\n    }\n  }, {\n    key: \"getColumnMap\",\n    value: function getColumnMap(sheet, col) {\n      if (!this.index.has(sheet)) {\n        this.index.set(sheet, []);\n      }\n\n      var sheetMap = this.index.get(sheet); // eslint-disable-line @typescript-eslint/no-non-null-assertion\n\n      var columnMap = sheetMap[col];\n\n      if (!columnMap) {\n        columnMap = new Map();\n        sheetMap[col] = columnMap;\n      }\n\n      return columnMap;\n    }\n  }, {\n    key: \"getValueIndex\",\n    value: function getValueIndex(sheet, col, value) {\n      var columnMap = this.getColumnMap(sheet, col);\n      var index = this.getColumnMap(sheet, col).get(value);\n\n      if (!index) {\n        index = {\n          version: this.transformingService.version(),\n          index: []\n        };\n        columnMap.set(value, index);\n      }\n\n      return index;\n    }\n  }, {\n    key: \"ensureRecentData\",\n    value: function ensureRecentData(sheet, col, value) {\n      var valueIndex = this.getValueIndex(sheet, col, value);\n      var actualVersion = this.transformingService.version();\n\n      if (valueIndex.version === actualVersion) {\n        return;\n      }\n\n      var relevantTransformations = this.transformingService.getTransformationsFrom(valueIndex.version, function (transformation) {\n        return transformation.sheet === sheet && (transformation instanceof AddRowsTransformer || transformation instanceof RemoveRowsTransformer);\n      });\n\n      var _iterator6 = _createForOfIteratorHelper(relevantTransformations),\n          _step6;\n\n      try {\n        for (_iterator6.s(); !(_step6 = _iterator6.n()).done;) {\n          var transformation = _step6.value;\n\n          if (transformation instanceof AddRowsTransformer) {\n            this.addRows(col, transformation.rowsSpan, value);\n          } else if (transformation instanceof RemoveRowsTransformer) {\n            this.removeRows(col, transformation.rowsSpan, value);\n          }\n        }\n      } catch (err) {\n        _iterator6.e(err);\n      } finally {\n        _iterator6.f();\n      }\n\n      valueIndex.version = actualVersion;\n    }\n  }, {\n    key: \"addSingleCellValue\",\n    value: function addSingleCellValue(value, address) {\n      var _this = this;\n\n      this.stats.measure(StatType.BUILD_COLUMN_INDEX, function () {\n        _this.ensureRecentData(address.sheet, address.col, value);\n\n        if (typeof value === 'string') {\n          value = forceNormalizeString(value);\n        }\n\n        var valueIndex = _this.getValueIndex(address.sheet, address.col, value);\n\n        _this.addValue(valueIndex, address.row);\n      });\n    }\n  }, {\n    key: \"removeSingleValue\",\n    value: function removeSingleValue(value, address) {\n      var _this2 = this;\n\n      this.stats.measure(StatType.BUILD_COLUMN_INDEX, function () {\n        _this2.ensureRecentData(address.sheet, address.col, value);\n\n        var columnMap = _this2.getColumnMap(address.sheet, address.col);\n\n        if (typeof value === 'string') {\n          value = forceNormalizeString(value);\n        }\n\n        var valueIndex = columnMap.get(value);\n\n        if (!valueIndex) {\n          return;\n        }\n\n        var index = upperBound(valueIndex.index, address.row);\n        valueIndex.index.splice(index, 1);\n\n        if (valueIndex.index.length === 0) {\n          columnMap.delete(value);\n        }\n\n        if (columnMap.size === 0) {\n          delete _this2.index.get(address.sheet)[address.col]; // eslint-disable-line @typescript-eslint/no-non-null-assertion\n        }\n      });\n    }\n  }, {\n    key: \"addRows\",\n    value: function addRows(col, rowsSpan, value) {\n      var valueIndex = this.getValueIndex(rowsSpan.sheet, col, value);\n      this.shiftRows(valueIndex, rowsSpan.rowStart, rowsSpan.numberOfRows);\n    }\n  }, {\n    key: \"removeRows\",\n    value: function removeRows(col, rowsSpan, value) {\n      var valueIndex = this.getValueIndex(rowsSpan.sheet, col, value);\n      this.removeRowsFromValues(valueIndex, rowsSpan);\n      this.shiftRows(valueIndex, rowsSpan.rowEnd + 1, -rowsSpan.numberOfRows);\n    }\n  }, {\n    key: \"addValue\",\n    value: function addValue(valueIndex, rowNumber) {\n      var rowIndex = lowerBound(valueIndex.index, rowNumber);\n      var value = valueIndex.index[rowIndex];\n\n      if (value === rowNumber) {\n        /* do not add same row twice */\n        return;\n      }\n\n      if (rowIndex === valueIndex.index.length - 1) {\n        valueIndex.index.push(rowNumber);\n      } else {\n        valueIndex.index.splice(rowIndex + 1, 0, rowNumber);\n      }\n    }\n  }, {\n    key: \"removeRowsFromValues\",\n    value: function removeRowsFromValues(rows, rowsSpan) {\n      var start = upperBound(rows.index, rowsSpan.rowStart);\n      var end = lowerBound(rows.index, rowsSpan.rowEnd);\n\n      if (rows.index[start] <= rowsSpan.rowEnd) {\n        rows.index.splice(start, end - start + 1);\n      }\n    }\n  }, {\n    key: \"shiftRows\",\n    value: function shiftRows(rows, afterRow, numberOfRows) {\n      var index = upperBound(rows.index, afterRow);\n\n      for (var i = index; i < rows.index.length; ++i) {\n        rows.index[i] += numberOfRows;\n      }\n    }\n  }]);\n\n  return ColumnIndex;\n}();\n/*\n* If key exists returns index of key\n* Otherwise returns index of smallest element greater than key\n* assuming sorted array and no repetitions\n* */\n\nexport function upperBound(values, key) {\n  var start = 0;\n  var end = values.length - 1;\n\n  while (start <= end) {\n    var center = Math.floor((start + end) / 2);\n\n    if (key > values[center]) {\n      start = center + 1;\n    } else if (key < values[center]) {\n      end = center - 1;\n    } else {\n      return center;\n    }\n  }\n\n  return start;\n}\n/*\n* If key exists returns index of key\n* Otherwise returns index of greatest element smaller than key\n* assuming sorted array and no repetitions\n* */\n\nexport function lowerBound(values, key) {\n  var start = 0;\n  var end = values.length - 1;\n\n  while (start <= end) {\n    var center = Math.floor((start + end) / 2);\n\n    if (key > values[center]) {\n      start = center + 1;\n    } else if (key < values[center]) {\n      end = center - 1;\n    } else {\n      return center;\n    }\n  }\n\n  return end;\n}"]},"metadata":{},"sourceType":"module"}