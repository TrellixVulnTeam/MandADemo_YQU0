{"ast":null,"code":"function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n/**\n * @license\n * Copyright (c) 2021 Handsoncode. All rights reserved.\n */\n\n\nimport { Exporter } from './Exporter';\nimport { LazilyTransformingAstService } from './LazilyTransformingAstService';\nimport { CellContentParser } from './CellContentParser';\nimport { buildColumnSearchStrategy } from './Lookup/SearchStrategy';\nimport { Config } from './Config';\nimport { DateTimeHelper } from './DateTimeHelper';\nimport { CrudOperations } from './CrudOperations';\nimport { DependencyGraph } from './DependencyGraph';\nimport { Evaluator } from './Evaluator';\nimport { GraphBuilder } from './GraphBuilder';\nimport { UIElement } from './i18n';\nimport { NamedExpressions } from './NamedExpressions';\nimport { NumberLiteralHelper } from './NumberLiteralHelper';\nimport { buildLexerConfig, ParserWithCaching, Unparser } from './parser';\nimport { Serialization } from './Serialization';\nimport { EmptyStatistics, Statistics, StatType } from './statistics';\nimport { SheetSizeLimitExceededError } from './errors';\nimport { findBoundaries, validateAsSheet } from './Sheet';\nimport { FunctionRegistry } from './interpreter/FunctionRegistry';\nexport var BuildEngineFactory = /*#__PURE__*/function () {\n  function BuildEngineFactory() {\n    _classCallCheck(this, BuildEngineFactory);\n  }\n\n  _createClass(BuildEngineFactory, null, [{\n    key: \"buildEngine\",\n    value: function buildEngine(config) {\n      var sheets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var stats = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : config.useStats ? new Statistics() : new EmptyStatistics();\n      stats.start(StatType.BUILD_ENGINE_TOTAL);\n      var namedExpressions = new NamedExpressions();\n      var functionRegistry = new FunctionRegistry(config);\n      var lazilyTransformingAstService = new LazilyTransformingAstService(stats);\n      var dependencyGraph = DependencyGraph.buildEmpty(lazilyTransformingAstService, config, functionRegistry, namedExpressions, stats);\n      var columnSearch = buildColumnSearchStrategy(dependencyGraph, config, stats);\n      var sheetMapping = dependencyGraph.sheetMapping;\n      var addressMapping = dependencyGraph.addressMapping;\n\n      for (var sheetName in sheets) {\n        if (Object.prototype.hasOwnProperty.call(sheets, sheetName)) {\n          var sheet = sheets[sheetName];\n          validateAsSheet(sheet);\n          var boundaries = findBoundaries(sheet);\n\n          if (boundaries.height > config.maxRows || boundaries.width > config.maxColumns) {\n            throw new SheetSizeLimitExceededError();\n          }\n\n          var sheetId = sheetMapping.addSheet(sheetName);\n          addressMapping.autoAddSheet(sheetId, sheet, boundaries);\n        }\n      }\n\n      var parser = new ParserWithCaching(config, functionRegistry, sheetMapping.get);\n      var unparser = new Unparser(config, buildLexerConfig(config), sheetMapping.fetchDisplayName, namedExpressions);\n      var dateHelper = new DateTimeHelper(config);\n      var numberLiteralHelper = new NumberLiteralHelper(config);\n      var cellContentParser = new CellContentParser(config, dateHelper, numberLiteralHelper);\n      var crudOperations = new CrudOperations(config, stats, dependencyGraph, columnSearch, parser, cellContentParser, lazilyTransformingAstService, namedExpressions);\n      stats.measure(StatType.GRAPH_BUILD, function () {\n        var graphBuilder = new GraphBuilder(dependencyGraph, columnSearch, parser, cellContentParser, config, stats);\n        graphBuilder.buildGraph(sheets);\n      });\n      lazilyTransformingAstService.undoRedo = crudOperations.undoRedo;\n      lazilyTransformingAstService.parser = parser;\n      var exporter = new Exporter(config, namedExpressions, sheetMapping.fetchDisplayName);\n      var serialization = new Serialization(dependencyGraph, unparser, config, exporter);\n      var evaluator = new Evaluator(dependencyGraph, columnSearch, config, stats, dateHelper, numberLiteralHelper, functionRegistry, namedExpressions, serialization);\n      evaluator.run();\n      stats.end(StatType.BUILD_ENGINE_TOTAL);\n      return {\n        config: config,\n        stats: stats,\n        dependencyGraph: dependencyGraph,\n        columnSearch: columnSearch,\n        parser: parser,\n        unparser: unparser,\n        cellContentParser: cellContentParser,\n        evaluator: evaluator,\n        lazilyTransformingAstService: lazilyTransformingAstService,\n        crudOperations: crudOperations,\n        exporter: exporter,\n        namedExpressions: namedExpressions,\n        serialization: serialization,\n        functionRegistry: functionRegistry\n      };\n    }\n  }, {\n    key: \"buildFromSheets\",\n    value: function buildFromSheets(sheets, configInput) {\n      var config = new Config(configInput);\n      return this.buildEngine(config, sheets);\n    }\n  }, {\n    key: \"buildFromSheet\",\n    value: function buildFromSheet(sheet, configInput) {\n      var config = new Config(configInput);\n      var newsheetprefix = config.translationPackage.getUITranslation(UIElement.NEW_SHEET_PREFIX) + '1';\n      return this.buildEngine(config, _defineProperty({}, newsheetprefix, sheet));\n    }\n  }, {\n    key: \"buildEmpty\",\n    value: function buildEmpty(configInput) {\n      return this.buildEngine(new Config(configInput));\n    }\n  }, {\n    key: \"rebuildWithConfig\",\n    value: function rebuildWithConfig(config, sheets, stats) {\n      return this.buildEngine(config, sheets, stats);\n    }\n  }]);\n\n  return BuildEngineFactory;\n}();","map":{"version":3,"sources":["/Users/mingjie.wang/Documents/Uber/MandA/demo-project/node_modules/hyperformula/es/BuildEngineFactory.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","_createClass","protoProps","staticProps","prototype","Exporter","LazilyTransformingAstService","CellContentParser","buildColumnSearchStrategy","Config","DateTimeHelper","CrudOperations","DependencyGraph","Evaluator","GraphBuilder","UIElement","NamedExpressions","NumberLiteralHelper","buildLexerConfig","ParserWithCaching","Unparser","Serialization","EmptyStatistics","Statistics","StatType","SheetSizeLimitExceededError","findBoundaries","validateAsSheet","FunctionRegistry","BuildEngineFactory","buildEngine","config","sheets","arguments","undefined","stats","useStats","start","BUILD_ENGINE_TOTAL","namedExpressions","functionRegistry","lazilyTransformingAstService","dependencyGraph","buildEmpty","columnSearch","sheetMapping","addressMapping","sheetName","hasOwnProperty","call","sheet","boundaries","height","maxRows","width","maxColumns","sheetId","addSheet","autoAddSheet","parser","get","unparser","fetchDisplayName","dateHelper","numberLiteralHelper","cellContentParser","crudOperations","measure","GRAPH_BUILD","graphBuilder","buildGraph","undoRedo","exporter","serialization","evaluator","run","end","buildFromSheets","configInput","buildFromSheet","newsheetprefix","translationPackage","getUITranslation","NEW_SHEET_PREFIX","rebuildWithConfig"],"mappings":"AAAA,SAASA,eAAT,CAAyBC,GAAzB,EAA8BC,GAA9B,EAAmCC,KAAnC,EAA0C;AAAE,MAAID,GAAG,IAAID,GAAX,EAAgB;AAAEG,IAAAA,MAAM,CAACC,cAAP,CAAsBJ,GAAtB,EAA2BC,GAA3B,EAAgC;AAAEC,MAAAA,KAAK,EAAEA,KAAT;AAAgBG,MAAAA,UAAU,EAAE,IAA5B;AAAkCC,MAAAA,YAAY,EAAE,IAAhD;AAAsDC,MAAAA,QAAQ,EAAE;AAAhE,KAAhC;AAA0G,GAA5H,MAAkI;AAAEP,IAAAA,GAAG,CAACC,GAAD,CAAH,GAAWC,KAAX;AAAmB;;AAAC,SAAOF,GAAP;AAAa;;AAEjN,SAASQ,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAAE,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,KAAK,CAACE,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AAAE,QAAIE,UAAU,GAAGH,KAAK,CAACC,CAAD,CAAtB;AAA2BE,IAAAA,UAAU,CAACZ,UAAX,GAAwBY,UAAU,CAACZ,UAAX,IAAyB,KAAjD;AAAwDY,IAAAA,UAAU,CAACX,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWW,UAAf,EAA2BA,UAAU,CAACV,QAAX,GAAsB,IAAtB;AAA4BJ,IAAAA,MAAM,CAACC,cAAP,CAAsBS,MAAtB,EAA8BI,UAAU,CAAChB,GAAzC,EAA8CgB,UAA9C;AAA4D;AAAE;;AAE7T,SAASC,YAAT,CAAsBR,WAAtB,EAAmCS,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBP,iBAAiB,CAACF,WAAW,CAACW,SAAb,EAAwBF,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBR,iBAAiB,CAACF,WAAD,EAAcU,WAAd,CAAjB;AAA6C,SAAOV,WAAP;AAAqB;AAEvN;AACA;AACA;AACA;;;AACA,SAASY,QAAT,QAAyB,YAAzB;AACA,SAASC,4BAAT,QAA6C,gCAA7C;AACA,SAASC,iBAAT,QAAkC,qBAAlC;AACA,SAASC,yBAAT,QAA0C,yBAA1C;AACA,SAASC,MAAT,QAAuB,UAAvB;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,cAAT,QAA+B,kBAA/B;AACA,SAASC,eAAT,QAAgC,mBAAhC;AACA,SAASC,SAAT,QAA0B,aAA1B;AACA,SAASC,YAAT,QAA6B,gBAA7B;AACA,SAASC,SAAT,QAA0B,QAA1B;AACA,SAASC,gBAAT,QAAiC,oBAAjC;AACA,SAASC,mBAAT,QAAoC,uBAApC;AACA,SAASC,gBAAT,EAA2BC,iBAA3B,EAA8CC,QAA9C,QAA8D,UAA9D;AACA,SAASC,aAAT,QAA8B,iBAA9B;AACA,SAASC,eAAT,EAA0BC,UAA1B,EAAsCC,QAAtC,QAAsD,cAAtD;AACA,SAASC,2BAAT,QAA4C,UAA5C;AACA,SAASC,cAAT,EAAyBC,eAAzB,QAAgD,SAAhD;AACA,SAASC,gBAAT,QAAiC,gCAAjC;AACA,OAAO,IAAIC,kBAAkB,GAAG,aAAa,YAAY;AACvD,WAASA,kBAAT,GAA8B;AAC5BtC,IAAAA,eAAe,CAAC,IAAD,EAAOsC,kBAAP,CAAf;AACD;;AAED5B,EAAAA,YAAY,CAAC4B,kBAAD,EAAqB,IAArB,EAA2B,CAAC;AACtC7C,IAAAA,GAAG,EAAE,aADiC;AAEtCC,IAAAA,KAAK,EAAE,SAAS6C,WAAT,CAAqBC,MAArB,EAA6B;AAClC,UAAIC,MAAM,GAAGC,SAAS,CAAClC,MAAV,GAAmB,CAAnB,IAAwBkC,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoE,EAAjF;AACA,UAAIE,KAAK,GAAGF,SAAS,CAAClC,MAAV,GAAmB,CAAnB,IAAwBkC,SAAS,CAAC,CAAD,CAAT,KAAiBC,SAAzC,GAAqDD,SAAS,CAAC,CAAD,CAA9D,GAAoEF,MAAM,CAACK,QAAP,GAAkB,IAAIb,UAAJ,EAAlB,GAAqC,IAAID,eAAJ,EAArH;AACAa,MAAAA,KAAK,CAACE,KAAN,CAAYb,QAAQ,CAACc,kBAArB;AACA,UAAIC,gBAAgB,GAAG,IAAIvB,gBAAJ,EAAvB;AACA,UAAIwB,gBAAgB,GAAG,IAAIZ,gBAAJ,CAAqBG,MAArB,CAAvB;AACA,UAAIU,4BAA4B,GAAG,IAAInC,4BAAJ,CAAiC6B,KAAjC,CAAnC;AACA,UAAIO,eAAe,GAAG9B,eAAe,CAAC+B,UAAhB,CAA2BF,4BAA3B,EAAyDV,MAAzD,EAAiES,gBAAjE,EAAmFD,gBAAnF,EAAqGJ,KAArG,CAAtB;AACA,UAAIS,YAAY,GAAGpC,yBAAyB,CAACkC,eAAD,EAAkBX,MAAlB,EAA0BI,KAA1B,CAA5C;AACA,UAAIU,YAAY,GAAGH,eAAe,CAACG,YAAnC;AACA,UAAIC,cAAc,GAAGJ,eAAe,CAACI,cAArC;;AAEA,WAAK,IAAIC,SAAT,IAAsBf,MAAtB,EAA8B;AAC5B,YAAI9C,MAAM,CAACkB,SAAP,CAAiB4C,cAAjB,CAAgCC,IAAhC,CAAqCjB,MAArC,EAA6Ce,SAA7C,CAAJ,EAA6D;AAC3D,cAAIG,KAAK,GAAGlB,MAAM,CAACe,SAAD,CAAlB;AACApB,UAAAA,eAAe,CAACuB,KAAD,CAAf;AACA,cAAIC,UAAU,GAAGzB,cAAc,CAACwB,KAAD,CAA/B;;AAEA,cAAIC,UAAU,CAACC,MAAX,GAAoBrB,MAAM,CAACsB,OAA3B,IAAsCF,UAAU,CAACG,KAAX,GAAmBvB,MAAM,CAACwB,UAApE,EAAgF;AAC9E,kBAAM,IAAI9B,2BAAJ,EAAN;AACD;;AAED,cAAI+B,OAAO,GAAGX,YAAY,CAACY,QAAb,CAAsBV,SAAtB,CAAd;AACAD,UAAAA,cAAc,CAACY,YAAf,CAA4BF,OAA5B,EAAqCN,KAArC,EAA4CC,UAA5C;AACD;AACF;;AAED,UAAIQ,MAAM,GAAG,IAAIxC,iBAAJ,CAAsBY,MAAtB,EAA8BS,gBAA9B,EAAgDK,YAAY,CAACe,GAA7D,CAAb;AACA,UAAIC,QAAQ,GAAG,IAAIzC,QAAJ,CAAaW,MAAb,EAAqBb,gBAAgB,CAACa,MAAD,CAArC,EAA+Cc,YAAY,CAACiB,gBAA5D,EAA8EvB,gBAA9E,CAAf;AACA,UAAIwB,UAAU,GAAG,IAAIrD,cAAJ,CAAmBqB,MAAnB,CAAjB;AACA,UAAIiC,mBAAmB,GAAG,IAAI/C,mBAAJ,CAAwBc,MAAxB,CAA1B;AACA,UAAIkC,iBAAiB,GAAG,IAAI1D,iBAAJ,CAAsBwB,MAAtB,EAA8BgC,UAA9B,EAA0CC,mBAA1C,CAAxB;AACA,UAAIE,cAAc,GAAG,IAAIvD,cAAJ,CAAmBoB,MAAnB,EAA2BI,KAA3B,EAAkCO,eAAlC,EAAmDE,YAAnD,EAAiEe,MAAjE,EAAyEM,iBAAzE,EAA4FxB,4BAA5F,EAA0HF,gBAA1H,CAArB;AACAJ,MAAAA,KAAK,CAACgC,OAAN,CAAc3C,QAAQ,CAAC4C,WAAvB,EAAoC,YAAY;AAC9C,YAAIC,YAAY,GAAG,IAAIvD,YAAJ,CAAiB4B,eAAjB,EAAkCE,YAAlC,EAAgDe,MAAhD,EAAwDM,iBAAxD,EAA2ElC,MAA3E,EAAmFI,KAAnF,CAAnB;AACAkC,QAAAA,YAAY,CAACC,UAAb,CAAwBtC,MAAxB;AACD,OAHD;AAIAS,MAAAA,4BAA4B,CAAC8B,QAA7B,GAAwCL,cAAc,CAACK,QAAvD;AACA9B,MAAAA,4BAA4B,CAACkB,MAA7B,GAAsCA,MAAtC;AACA,UAAIa,QAAQ,GAAG,IAAInE,QAAJ,CAAa0B,MAAb,EAAqBQ,gBAArB,EAAuCM,YAAY,CAACiB,gBAApD,CAAf;AACA,UAAIW,aAAa,GAAG,IAAIpD,aAAJ,CAAkBqB,eAAlB,EAAmCmB,QAAnC,EAA6C9B,MAA7C,EAAqDyC,QAArD,CAApB;AACA,UAAIE,SAAS,GAAG,IAAI7D,SAAJ,CAAc6B,eAAd,EAA+BE,YAA/B,EAA6Cb,MAA7C,EAAqDI,KAArD,EAA4D4B,UAA5D,EAAwEC,mBAAxE,EAA6FxB,gBAA7F,EAA+GD,gBAA/G,EAAiIkC,aAAjI,CAAhB;AACAC,MAAAA,SAAS,CAACC,GAAV;AACAxC,MAAAA,KAAK,CAACyC,GAAN,CAAUpD,QAAQ,CAACc,kBAAnB;AACA,aAAO;AACLP,QAAAA,MAAM,EAAEA,MADH;AAELI,QAAAA,KAAK,EAAEA,KAFF;AAGLO,QAAAA,eAAe,EAAEA,eAHZ;AAILE,QAAAA,YAAY,EAAEA,YAJT;AAKLe,QAAAA,MAAM,EAAEA,MALH;AAMLE,QAAAA,QAAQ,EAAEA,QANL;AAOLI,QAAAA,iBAAiB,EAAEA,iBAPd;AAQLS,QAAAA,SAAS,EAAEA,SARN;AASLjC,QAAAA,4BAA4B,EAAEA,4BATzB;AAULyB,QAAAA,cAAc,EAAEA,cAVX;AAWLM,QAAAA,QAAQ,EAAEA,QAXL;AAYLjC,QAAAA,gBAAgB,EAAEA,gBAZb;AAaLkC,QAAAA,aAAa,EAAEA,aAbV;AAcLjC,QAAAA,gBAAgB,EAAEA;AAdb,OAAP;AAgBD;AA9DqC,GAAD,EA+DpC;AACDxD,IAAAA,GAAG,EAAE,iBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS4F,eAAT,CAAyB7C,MAAzB,EAAiC8C,WAAjC,EAA8C;AACnD,UAAI/C,MAAM,GAAG,IAAItB,MAAJ,CAAWqE,WAAX,CAAb;AACA,aAAO,KAAKhD,WAAL,CAAiBC,MAAjB,EAAyBC,MAAzB,CAAP;AACD;AALA,GA/DoC,EAqEpC;AACDhD,IAAAA,GAAG,EAAE,gBADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS8F,cAAT,CAAwB7B,KAAxB,EAA+B4B,WAA/B,EAA4C;AACjD,UAAI/C,MAAM,GAAG,IAAItB,MAAJ,CAAWqE,WAAX,CAAb;AACA,UAAIE,cAAc,GAAGjD,MAAM,CAACkD,kBAAP,CAA0BC,gBAA1B,CAA2CnE,SAAS,CAACoE,gBAArD,IAAyE,GAA9F;AACA,aAAO,KAAKrD,WAAL,CAAiBC,MAAjB,EAAyBjD,eAAe,CAAC,EAAD,EAAKkG,cAAL,EAAqB9B,KAArB,CAAxC,CAAP;AACD;AANA,GArEoC,EA4EpC;AACDlE,IAAAA,GAAG,EAAE,YADJ;AAEDC,IAAAA,KAAK,EAAE,SAAS0D,UAAT,CAAoBmC,WAApB,EAAiC;AACtC,aAAO,KAAKhD,WAAL,CAAiB,IAAIrB,MAAJ,CAAWqE,WAAX,CAAjB,CAAP;AACD;AAJA,GA5EoC,EAiFpC;AACD9F,IAAAA,GAAG,EAAE,mBADJ;AAEDC,IAAAA,KAAK,EAAE,SAASmG,iBAAT,CAA2BrD,MAA3B,EAAmCC,MAAnC,EAA2CG,KAA3C,EAAkD;AACvD,aAAO,KAAKL,WAAL,CAAiBC,MAAjB,EAAyBC,MAAzB,EAAiCG,KAAjC,CAAP;AACD;AAJA,GAjFoC,CAA3B,CAAZ;;AAwFA,SAAON,kBAAP;AACD,CA9F4C,EAAtC","sourcesContent":["function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\n/**\n * @license\n * Copyright (c) 2021 Handsoncode. All rights reserved.\n */\nimport { Exporter } from './Exporter';\nimport { LazilyTransformingAstService } from './LazilyTransformingAstService';\nimport { CellContentParser } from './CellContentParser';\nimport { buildColumnSearchStrategy } from './Lookup/SearchStrategy';\nimport { Config } from './Config';\nimport { DateTimeHelper } from './DateTimeHelper';\nimport { CrudOperations } from './CrudOperations';\nimport { DependencyGraph } from './DependencyGraph';\nimport { Evaluator } from './Evaluator';\nimport { GraphBuilder } from './GraphBuilder';\nimport { UIElement } from './i18n';\nimport { NamedExpressions } from './NamedExpressions';\nimport { NumberLiteralHelper } from './NumberLiteralHelper';\nimport { buildLexerConfig, ParserWithCaching, Unparser } from './parser';\nimport { Serialization } from './Serialization';\nimport { EmptyStatistics, Statistics, StatType } from './statistics';\nimport { SheetSizeLimitExceededError } from './errors';\nimport { findBoundaries, validateAsSheet } from './Sheet';\nimport { FunctionRegistry } from './interpreter/FunctionRegistry';\nexport var BuildEngineFactory = /*#__PURE__*/function () {\n  function BuildEngineFactory() {\n    _classCallCheck(this, BuildEngineFactory);\n  }\n\n  _createClass(BuildEngineFactory, null, [{\n    key: \"buildEngine\",\n    value: function buildEngine(config) {\n      var sheets = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var stats = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : config.useStats ? new Statistics() : new EmptyStatistics();\n      stats.start(StatType.BUILD_ENGINE_TOTAL);\n      var namedExpressions = new NamedExpressions();\n      var functionRegistry = new FunctionRegistry(config);\n      var lazilyTransformingAstService = new LazilyTransformingAstService(stats);\n      var dependencyGraph = DependencyGraph.buildEmpty(lazilyTransformingAstService, config, functionRegistry, namedExpressions, stats);\n      var columnSearch = buildColumnSearchStrategy(dependencyGraph, config, stats);\n      var sheetMapping = dependencyGraph.sheetMapping;\n      var addressMapping = dependencyGraph.addressMapping;\n\n      for (var sheetName in sheets) {\n        if (Object.prototype.hasOwnProperty.call(sheets, sheetName)) {\n          var sheet = sheets[sheetName];\n          validateAsSheet(sheet);\n          var boundaries = findBoundaries(sheet);\n\n          if (boundaries.height > config.maxRows || boundaries.width > config.maxColumns) {\n            throw new SheetSizeLimitExceededError();\n          }\n\n          var sheetId = sheetMapping.addSheet(sheetName);\n          addressMapping.autoAddSheet(sheetId, sheet, boundaries);\n        }\n      }\n\n      var parser = new ParserWithCaching(config, functionRegistry, sheetMapping.get);\n      var unparser = new Unparser(config, buildLexerConfig(config), sheetMapping.fetchDisplayName, namedExpressions);\n      var dateHelper = new DateTimeHelper(config);\n      var numberLiteralHelper = new NumberLiteralHelper(config);\n      var cellContentParser = new CellContentParser(config, dateHelper, numberLiteralHelper);\n      var crudOperations = new CrudOperations(config, stats, dependencyGraph, columnSearch, parser, cellContentParser, lazilyTransformingAstService, namedExpressions);\n      stats.measure(StatType.GRAPH_BUILD, function () {\n        var graphBuilder = new GraphBuilder(dependencyGraph, columnSearch, parser, cellContentParser, config, stats);\n        graphBuilder.buildGraph(sheets);\n      });\n      lazilyTransformingAstService.undoRedo = crudOperations.undoRedo;\n      lazilyTransformingAstService.parser = parser;\n      var exporter = new Exporter(config, namedExpressions, sheetMapping.fetchDisplayName);\n      var serialization = new Serialization(dependencyGraph, unparser, config, exporter);\n      var evaluator = new Evaluator(dependencyGraph, columnSearch, config, stats, dateHelper, numberLiteralHelper, functionRegistry, namedExpressions, serialization);\n      evaluator.run();\n      stats.end(StatType.BUILD_ENGINE_TOTAL);\n      return {\n        config: config,\n        stats: stats,\n        dependencyGraph: dependencyGraph,\n        columnSearch: columnSearch,\n        parser: parser,\n        unparser: unparser,\n        cellContentParser: cellContentParser,\n        evaluator: evaluator,\n        lazilyTransformingAstService: lazilyTransformingAstService,\n        crudOperations: crudOperations,\n        exporter: exporter,\n        namedExpressions: namedExpressions,\n        serialization: serialization,\n        functionRegistry: functionRegistry\n      };\n    }\n  }, {\n    key: \"buildFromSheets\",\n    value: function buildFromSheets(sheets, configInput) {\n      var config = new Config(configInput);\n      return this.buildEngine(config, sheets);\n    }\n  }, {\n    key: \"buildFromSheet\",\n    value: function buildFromSheet(sheet, configInput) {\n      var config = new Config(configInput);\n      var newsheetprefix = config.translationPackage.getUITranslation(UIElement.NEW_SHEET_PREFIX) + '1';\n      return this.buildEngine(config, _defineProperty({}, newsheetprefix, sheet));\n    }\n  }, {\n    key: \"buildEmpty\",\n    value: function buildEmpty(configInput) {\n      return this.buildEngine(new Config(configInput));\n    }\n  }, {\n    key: \"rebuildWithConfig\",\n    value: function rebuildWithConfig(config, sheets, stats) {\n      return this.buildEngine(config, sheets, stats);\n    }\n  }]);\n\n  return BuildEngineFactory;\n}();"]},"metadata":{},"sourceType":"module"}